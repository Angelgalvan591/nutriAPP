{% extends "base.html" %}
{% block content %}

<div class="container my-5 font-monospace">
  <div>
    <div class="row g-4">

      <!-- INFORMACIÓN PERSONAL -->
      <div class="col-md-5">
        <div class="border border-dark rounded-3 p-4 position-relative" style="background-color: #c1aa94;">
          <h4 class="text-uppercase mb-3" style="font-family: 'Jersey 20'">Información Personal</h4>

          <div id="datos-view">
            <p><strong>Nombre:</strong> {{ usuario.nombre }} {{ usuario.apellidos }}</p>
            <p><strong>Edad:</strong> {{ usuario.edad }}</p>
            <p><strong>Género:</strong> {{ usuario.sexo }}</p>
            <p><strong>Peso:</strong> {{ usuario.peso }} kg</p>
            <p><strong>Altura:</strong> {{ usuario.altura }} cm</p
            <p><strong>Correo:</strong> {{ usuario.correo }}</p>
            <p><strong>Teléfono:</strong> {{ usuario.telefono }}</p>
          </div>

          <!-- Editar -->
          <form action="{{ url_for('editar_usuario') }}" method="POST" id="datos-edit" style="display:none">

            <label>Nombre</label>
            <input type="text" class="form-control mb-2" name="nombre" value="{{ usuario.nombre }}">

            <label>Apellidos</label>
            <input type="text" class="form-control mb-2" name="apellidos" value="{{ usuario.apellidos }}">

            <label>Edad</label>
            <input type="number" class="form-control mb-2" name="edad" value="{{ usuario.edad }}">

            <label>Género</label>
            <select name="genero" class="form-select mb-2">
                <option value="hombre" {% if usuario.genero=='hombre' %}selected{% endif %}>Hombre</option>
                <option value="mujer" {% if usuario.genero=='mujer' %}selected{% endif %}>Mujer</option>
                <option value="otro" {% if usuario.genero=='otro' %}selected{% endif %}>Otro</option>
            </select>

            <label>Teléfono</label>
            <input type="text" class="form-control mb-2" name="telefono" value="{{ usuario.telefono }}">

            <label>Peso (kg)</label>
            <input type="number" class="form-control mb-2" name="peso" value="{{ usuario.peso }}">

            <label>Altura (cm)</label>
            <input type="number" class="form-control mb-2" name="altura" value="{{ usuario.altura }}">

            <button class="btn btn-dark w-100 mt-3">Guardar cambios</button>
          </form>

          <button id="btn-editar" class="btn btn-outline-dark w-100 mt-3">Editar</button>
          <button id="btn-cancelar" class="btn btn-outline-secondary w-100 mt-3" style="display:none;">Cancelar</button>
        </div>
      </div>

      <!-- PREFERENCIAS -->
<div class="col-md-7">
  <div class="border border-dark rounded-3 p-4" style="background-color: #b1967a;">
    <div class="d-flex justify-content-between align-items-center mb-3">
      <h4 class="text-uppercase" style="font-family: 'Jersey 20'">
        Preferencias & Alergias
      </h4>
      <button class="btn btn-dark btn-sm" id="btn-add-pref">Editar</button>
    </div>

    <div id="lista-preferencias">
      {% if usuario.preferencias_lista %}
        {% for pref in usuario.preferencias_lista %}
          <p class="border-bottom py-1">{{ pref }}</p>
        {% endfor %}
      {% else %}
        <p class="text-muted">No hay preferencias registradas.</p>
      {% endif %}
    </div>

    <!-- MODIFICAR PREFERENCIAS -->
    <form action="{{ url_for('actualizar_preferencias') }}" method="POST"
          id="form-pref" class="mt-3" style="display:none">

      <label class="text-uppercase" style="font-family:'Jersey 20'">
        Nivel de actividad
      </label>
      <select class="form-select mb-3" name="actividad">
        <option value="">Sin cambiar</option>
        <option>Sedentario</option>
        <option>Ligero</option>
        <option>Moderado</option>
        <option>Activo</option>
        <option>Muy activo</option>
      </select>

      <label class="text-uppercase" style="font-family:'Jersey 20'">Objetivo</label>
      <select class="form-select mb-3" name="objetivo">
        <option value="">Sin cambiar</option>
        <option>Bajar de peso</option>
        <option>Aumentar masa muscular</option>
        <option>Mantener peso</option>
        <option>Mejorar digestión</option>
        <option>Controlar condición</option>
      </select>

      <label class="text-uppercase" style="font-family:'Jersey 20'">
        Alergias comunes
      </label>
      <select class="form-select mb-3" name="alergias">
        <option value="">Sin cambiar</option>
        <option>Gluten</option>
        <option>Lácteos</option>
        <option>Nueces</option>
        <option>Mariscos</option>
        <option>Huevo</option>
        <option>Soja</option>
      </select>

      <label class="text-uppercase" style="font-family:'Jersey 20'">
        Experiencia culinaria
      </label>
      <select class="form-select mb-3" name="experiencia">
        <option value="">Sin cambiar</option>
        <option>Principiante</option>
        <option>Intermedio</option>
        <option>Chef aficionado</option>
      </select>

      <button class="btn btn-dark w-100">Guardar</button>
    </form>
  </div>
</div>


    </div>

    <!-- CERRAR SESIÓN -->
    <div class="text-center mt-4">
      <a href="{{ url_for('cerrarsesion') }}" class="btn btn-outline-danger">Cerrar sesión</a>
    </div>
  </div>
</div>

<!-- MOSTRAR FORMULARIO DE EDICIÓN -->
<script>
  const btnEditar = document.getElementById("btn-editar");
  const btnCancelar = document.getElementById("btn-cancelar");
  const datosView = document.getElementById("datos-view");
  const datosEdit = document.getElementById("datos-edit");

  btnEditar.addEventListener("click", function () {
    datosView.style.display = "none";
    datosEdit.style.display = "block";
    btnEditar.style.display = "none";
    btnCancelar.style.display = "block";
  });

  btnCancelar.addEventListener("click", function () {
    datosView.style.display = "block";
    datosEdit.style.display = "none";
    btnEditar.style.display = "block";
    btnCancelar.style.display = "none";
  });
</script>

<!-- MOSTRAR FORMULARIO DE PREFERENCIAS -->
<script>
  document.getElementById("btn-add-pref").addEventListener("click", function(){
    const form = document.getElementById("form-pref");
    form.style.display = form.style.display === "none" ? "block" : "none";
  });
</script>

{% endblock %}
